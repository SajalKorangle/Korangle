<div class="card-content" *ngIf="!isLoading else MainLoader">
    <div>
        <mat-form-field style="margin-right: 20px;">
            <mat-select placeholder="Select Class" [(ngModel)]="userInput.selectedClass">
                <mat-option *ngFor="let classs of backendData.classList" [value]="classs">
                    {{ classs.name }}
                </mat-option>
            </mat-select>
        </mat-form-field>

        <mat-form-field style="margin-right: 20px;">
            <mat-select placeholder="Select Section" [(ngModel)]="userInput.selectedSection">
                <mat-option *ngFor="let division of backendData.divisionList" [value]="division">
                    {{ division.name }}
                </mat-option>
            </mat-select>
        </mat-form-field>
        <mat-divider></mat-divider>
    </div>

    <ng-container *ngIf="userInput.selectedClass && userInput.selectedSection || true">

        <div style="overflow: auto;">
            <table class="mat-elevation-z8 table table-hover">
                <thead>
                    <tr>
                        <th></th>
                        <th *ngFor="let weekday of weekdays">{{weekday}}</th>
                    </tr>
                </thead>
                <tbody>
                    <ng-container *ngFor="let timespan of userInput.timeSpanList, let timeSpanIndex = index;">
                        <tr>
                            <td style="width: 200px">
                                <ng-container
                                    *ngIf="htmlRenderer.editTimeSpanFormIndex!=timeSpanIndex else EditTimeSpanForm">
                                    {{timespan.startTime.hour}}:{{timespan.startTime.minute.toString().padEnd(2, '0')}}
                                    {{timespan.startTime.ampm}}
                                    - {{timespan.endTime.hour}}:{{timespan.endTime.minute.toString().padEnd(2, '0')}}
                                    {{timespan.endTime.ampm}}
                                    <mat-icon class="td-hover-show"
                                        (click)="htmlRenderer.editTimeSpanFormIndex=timeSpanIndex; htmlRenderer.setupEditTimeSpan()"
                                        style="font-size: small;">edit</mat-icon>
                                </ng-container>
                            </td>
                            <ng-container *ngFor="let weekday of weekdays">
                                <td></td>
                            </ng-container>
                        </tr>
                    </ng-container>
                    <tr>
                        <td style="width: 200px">
                            <button mat-fab (click)="htmlRenderer.newTimeSpanForm = true;"
                                *ngIf="!htmlRenderer.newTimeSpanForm else NewTimeSpanForm">
                                <mat-icon>add</mat-icon>
                            </button>
                        </td>
                        <ng-container *ngFor="let weekday of weekdays">
                            <td></td>
                        </ng-container>
                    </tr>
                </tbody>
            </table>
        </div>
    </ng-container>
    <mat-divider style="margin-top: 32px;"></mat-divider>

</div>

<ng-template #MainLoader>
    <app-loading-spinner [user]="user"></app-loading-spinner>
</ng-template>

<ng-template #NewTimeSpanForm>
    <mat-form-field>
        <mat-label>Start Time</mat-label>
        <input matInput type="time" [errorStateMatcher]="{isErrorState: htmlRenderer.newTimeSpanError}"
            [(ngModel)]="userInput.newTimeSpan.startTime">
    </mat-form-field>
    <mat-form-field>
        <mat-label>End Time</mat-label>
        <input matInput [errorStateMatcher]="{isErrorState: htmlRenderer.newTimeSpanError}" type="time"
            [(ngModel)]="userInput.newTimeSpan.endTime">
        <mat-error *ngIf="htmlRenderer.endTimeBeforeStartTime()">End time before start time</mat-error>
        <mat-error *ngIf="htmlRenderer.timeSpanOverlapping()">Time Span Overlapping </mat-error>
    </mat-form-field>
    <button mat-stroked-button [disabled]="htmlRenderer.newTimeSpanError()" style="margin-top: 6px;"
        (click)="userInput.addNewTimeSpan(); htmlRenderer.newTimeSpanForm = false;">Add</button>
</ng-template>


<ng-template #EditTimeSpanForm>
    <mat-form-field>
        <mat-label>Start Time</mat-label>
        <input matInput type="time" [errorStateMatcher]="{isErrorState: htmlRenderer.editTimeSpanError}"
            [(ngModel)]="userInput.newTimeSpan.startTime">
    </mat-form-field>

    <mat-form-field>
        <mat-label>End Time</mat-label>
        <input matInput [errorStateMatcher]="{isErrorState: htmlRenderer.editTimeSpanError}" type="time"
            [(ngModel)]="userInput.newTimeSpan.endTime">
        <mat-error *ngIf="htmlRenderer.endTimeBeforeStartTime()">End time before start time</mat-error>
        <mat-error *ngIf="htmlRenderer.timeSpanOverlapping()">Time Span Overlapping </mat-error>
    </mat-form-field>

    <button mat-stroked-button style="margin-top: 6px; margin-right: 6px;">
        <mat-icon>delete</mat-icon>
    </button>
    <button mat-stroked-button [disabled]="htmlRenderer.newTimeSpanError()" style="margin-top: 6px;"
        (click)="userInput.editTimeSpan(); htmlRenderer.editTimeSpanForm = -1;">Update</button>
</ng-template>