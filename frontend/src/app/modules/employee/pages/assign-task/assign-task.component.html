<div class="card-content">
    <ng-container>
        <div class="row">
            <div class="col-sm-8">
                <ng-container *ngIf="selectedAssignTaskOption == assignTaskOptions[0]">
                    <app-employee-filter [user]="user"
                        (employee)="selectedEmployee = $event; serviceAdapter.getPermissionList()"
                        (emitEmployeeList)="employeeList = $event"></app-employee-filter>
                </ng-container>
                <ng-container *ngIf="selectedAssignTaskOption == assignTaskOptions[1]">
                    <mat-form-field>
                        <mat-select placeholder="Select module" [ngModel]="selectedModule"
                            (ngModelChange)="selectedModule = $event">
                            <mat-option *ngFor="let module of moduleList" [value]="module">
                                {{ module.title }}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                    <mat-form-field *ngIf="selectedModule && selectedAssignTaskOption == assignTaskOptions[1]"
                        style="margin-left: 20px">
                        <mat-select placeholder="Select task" [ngModel]="selectedTask"
                            (ngModelChange)="selectedTask = $event; serviceAdapter.getPermissionList()">
                            <mat-option *ngFor="let task of selectedModule.taskList" [value]="task">
                                {{ task.title }}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </ng-container>
            </div>

            <div class="col-sm-4" align="end">
                <mat-form-field>
                    <mat-select placeholder="Select Filter Type" [ngModel]="selectedAssignTaskOption"
                        (ngModelChange)="changeFilterVal($event)">
                        <mat-option *ngFor="let filter of assignTaskOptions" [value]="filter">
                            {{ filter }}
                        </mat-option>
                    </mat-select>
                </mat-form-field>
            </div>
        </div>

        <div class="row" *ngIf="selectedAssignTaskOption == assignTaskOptions[0]">
            <!--Filter by Employee-->
            <ng-container *ngIf="selectedEmployee && !isLoading">
                <span style="font-weight: 800; font-size: 20px">{{ selectedEmployee.name }}</span><br />
                <button class="btn" style="padding: 4px 7px"
                    (click)="assignAllTasks(selectedEmployee); $event.stopPropagation()">
                    Grant All</button><button class="btn" style="padding: 4px 7px"
                    (click)="removeAllPermissions(selectedEmployee); $event.stopPropagation()">
                    Remove All</button><br />

                <ng-container *ngFor="let module of moduleList">
                    <hr />
                    <h4 style="display: flex; flex-direction: row; align-items: center;">
                        <mat-icon style="margin-right: 8px;">{{module.icon}}</mat-icon>{{ module.title }}
                    </h4>
                    <div style="display: flex; flex-wrap: wrap;">
                        <ng-container *ngFor="let task of module.taskList">
                            <!-- <mat-checkbox
                                [ngModel]="hasPermission(selectedEmployee, task)"
                                (ngModelChange)="updatePermission(selectedEmployee, task)"
                                [disabled]="isDisabled(module, task, selectedEmployee)"
                            >
                                {{ task.title }}
                                <br />
                            </mat-checkbox>
                            <div *ngIf="isPermissionLoading(selectedEmployee, task)" class="loader-custom"></div>
                            <br /> -->
                            <mat-card
                                style="margin: 8px; cursor: pointer; overflow: hidden; position: relative; display: flex; flex-direction: row; align-items: center;"
                                (click)="updatePermission(selectedEmployee, task)"
                                [style.backgroundColor]="hasPermission(selectedEmployee, task)?'#4caf50':isDisabled(module, task, selectedEmployee)?'lightgrey':'white'"
                                [style.color]="hasPermission(selectedEmployee, task)?'white':'black'"
                                [style.opacity]="isDisabled(module, task, selectedEmployee)?'0.6':'1'"
                                [style.pointerEvents]="isDisabled(module, task, selectedEmployee)?'none':'auto'"
                                [style.paddingRight]="hasInPageTaskPermission(module, task)?'4px':''">
                                <span>{{task.title}}</span>
                                <mat-icon style="margin-left: 8px;" *ngIf="hasInPageTaskPermission(module, task)"
                                    (click)="openInPagePermissionDialog(module, task); $event.stopPropagation()"
                                    matTooltip="In-Page Permission">
                                    more_vert</mat-icon>
                                <div *ngIf="isPermissionLoading(selectedEmployee, task)"
                                    style="position: absolute; top: 0; left: 0; height: 100%; width: 100%; display: flex; background-color: inherit;">
                                    <div style="margin: auto" class="loader-custom"></div>
                                </div>
                            </mat-card>
                        </ng-container>
                    </div>
                </ng-container>
            </ng-container>
        </div>
        <div class="row" *ngIf="selectedAssignTaskOption == assignTaskOptions[1]">
            <div class="row"></div>
            <ng-container *ngIf="selectedTask && !isLoading">
                <span style="font-weight: 800; font-size: 20px">{{ selectedModule.title }} - {{ selectedTask.title
                    }}</span><br />

                <ng-container *ngFor="let employee of employeeList">
                    <mat-checkbox [ngModel]="hasPermission(employee, selectedTask)"
                        (ngModelChange)="updatePermission(employee, selectedTask)">
                        {{ employee.name }}
                        <br />
                    </mat-checkbox>
                    <div *ngIf="isPermissionLoading(employee, selectedTask)" class="loader-custom"></div>
                    <br />
                </ng-container>
            </ng-container>
        </div>
    </ng-container>
</div>

<ng-container *ngIf="isLoading">
    <app-loading-spinner [user]="user"></app-loading-spinner>
</ng-container>