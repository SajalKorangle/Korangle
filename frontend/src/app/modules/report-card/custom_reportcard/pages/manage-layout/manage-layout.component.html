<div class="card-content" style="height: 85vh;">
	<div class="row" *ngIf="!isLoading && examinationList.length == 0">
		<div class="col-md-12" *ngIf="examinationList.length == 0">
			No examination created.
		</div>
	</div>

	<ng-container *ngIf="isLoading">
        <app-loading-spinner [user]="user"></app-loading-spinner>
	</ng-container>
	
	<div class="row" *ngIf="!isLoading && examinationList.length != 0" style="height: 100%;overflow: auto;">
		

		<!-- Parameter Section  -->
		<div class="col-xs-6" style="height: 100%; overflow: auto;">

			<!-- Existing layouts dropdown -->
			<mat-card *ngIf="layoutList.length != 0" style="margin-bottom: 0.5vh">
				<mat-form-field>
					<mat-label>
						Edit existing Layout
					</mat-label>
					<mat-select (selectionChange)="initializeLayout($event.value)">
						<mat-option *ngFor="let layout of layoutList" [value]="layout">
							{{layout.name}}
						</mat-option>
					</mat-select>
				</mat-form-field>
			</mat-card>

			<mat-card *ngIf="currentLayout != null">
				<p>Customised Report Card</p>
				<div class="row">
					<mat-form-field class="col-md-6">
						<span style="color:red" *ngIf="!isLayoutNameUnique() && !currentLayout.id" class="small">
							Layout name must be unique
						</span>
						<mat-label>
							Layout Name
						</mat-label>
						<input matInput placeholder="Enter Layout Name" [(ngModel)]="currentLayout.name" required>
					</mat-form-field>

					<mat-form-field class="col-md-6">
						<mat-label>Report Card Heading</mat-label>
						<input matInput
						          [(ngModel)]="currentLayout.reportCardHeading">
					</mat-form-field>

					<div class="col-md-12" style="box-sizing: border-box;">
						<mat-checkbox [(ngModel)]="currentLayout.showLetterHeadImage">
							Use school Letterhead
						</mat-checkbox>
					</div>

					<div class="col-md-12" *ngIf="currentLayout.attendanceOrderNumber!==0">
						<div class="row">
							<mat-form-field class="col-md-6">
								<mat-label>Start date</mat-label>
								<input matInput type="date" [(ngModel)]="currentLayout.attendanceStartDate">
							</mat-form-field>
							<mat-form-field class="col-md-6">
								<mat-label>End date</mat-label>
								<input matInput type="date" [(ngModel)]="currentLayout.attendanceEndDate">
							</mat-form-field>
						</div>
					</div>
				</div>


			</mat-card>

			<mat-accordion *ngIf="currentLayout" multi="false">
				<mat-expansion-panel style="margin-bottom:0.6vh;">
					<mat-expansion-panel-header>
						<mat-panel-title>
							Student Header Mapping Section
						</mat-panel-title>
					</mat-expansion-panel-header>

					<!-- Student Detail Header Parameter -->
					<div cdkDropList 
						class="example-list" 
						(cdkDropListDropped)="dropHeaderHandler($event)">
						<div class="example-box" cdkDrag *ngFor="let header_key of getCurrentHeaderList()">
							{{STUDENT_DETAILS_HEADER[header_key]}}
							<span style="float:right;cursor: default;color:red" (click)="removeHeaderKey(header_key)">
								Remove
							</span>
						</div>
					</div>

					<div>
						<mat-form-field>
							<mat-label>Add new Header paramter</mat-label>
							<mat-select (selectionChange)="addHeaderKey($event.value)">
								<ng-container *ngFor="let header_key of getRemainingHeaderList()">
									<mat-option [value]="header_key">
										{{STUDENT_DETAILS_HEADER[header_key]}}
									</mat-option>
								</ng-container>
							</mat-select>
						</mat-form-field>
					</div>	
				</mat-expansion-panel>

				<mat-expansion-panel style="margin-bottom: 0.6vh;">
					<mat-expansion-panel-header >
						<mat-panel-title>
							Examination Mapping Section		
						</mat-panel-title>
					</mat-expansion-panel-header>

					<!-- Subject Count input -->
					<div>
						<mat-form-field class="col-xs-4" matTooltip="Number of subjects to be shown for preview" matTooltipPosition="above">
							<label>Max. of Subjects</label>
							<input matInput type="number" min="0" max="10" step="1" [(ngModel)]="subjectsToShow" />
						</mat-form-field>

						<mat-form-field class="col-xs-4">
							<label>Decimal place</label>
							<input matInput type="number" min="0" max="2" step="1" [(ngModel)]="currentLayout.decimalPlaces">
						</mat-form-field>
						<mat-form-field class="col-xs-4">
							<label>Passing %</label>
							<input matInput type="number" min="0" max="100" step="1" [(ngModel)]="currentLayout.passingPercentage">
						</mat-form-field>
					</div>

					<!-- Examination List -->
					<mat-form-field>
						<mat-label>Select Examination to map</mat-label>
						<mat-select (selectionChange)="addLayoutExamColumn($event.value)">
							<ng-container *ngFor="let examination of getRemainingExaminationList()" >
								<mat-option [value]="examination">
									{{examination.name}}
								</mat-option>
							</ng-container>
						</mat-select>
					</mat-form-field>					

					<!-- LayoutExamColumn  parameter -->					
					<mat-accordion cdkDropList class="example-list" (cdkDropListDropped)="dropExamHandler($event)">
						<ng-container *ngFor="let layoutExamColumn of layoutExamColumnList">
							<mat-expansion-panel class="example-box" cdkDrag>
									<mat-expansion-panel-header>
										<mat-panel-title>
										  {{getExamination(layoutExamColumn.parentExamination).name}}
										</mat-panel-title>
									</mat-expansion-panel-header>
  
									<mat-form-field>
										<mat-label>
											Report card exam name
										</mat-label>
										<input matInput [(ngModel)]="layoutExamColumn.name">
									</mat-form-field>
									
									<button class="btn btn-danger" (click)="removeLayoutExamColumn(layoutExamColumn)" style="float: right;">
										Remove
									</button>
  
									<mat-form-field>
										<mat-label>Column Type</mat-label>
										<mat-select [(value)]="layoutExamColumn.columnType">
											<mat-option *ngFor="let exam_type of EXAM_COLUMN_TYPE" [value]="exam_type">
												{{exam_type}}
											</mat-option>
										</mat-select>
									</mat-form-field>
  
									<mat-form-field>
									  <mat-label *ngIf="layoutExamColumn.columnType.split('/').length == 2">
										  {{layoutExamColumn.columnType.split('/')[0]}}  Maximum Marks
										</mat-label>
										<mat-label *ngIf="layoutExamColumn.columnType.split('/').length == 1">
											Maximum Marks
										</mat-label>
										<input matInput type="number" min="0" [(ngModel)]="layoutExamColumn.maximumMarksObtainedOne">
									</mat-form-field>
  
									<mat-form-field *ngIf="layoutExamColumn.columnType.split('/').length == 2">
										<mat-label>
											{{layoutExamColumn.columnType.split('/')[1]}} Maximum Marks
										</mat-label>
										<input matInput type="number" min="0" [(ngModel)]="layoutExamColumn.maximumMarksObtainedTwo">
									</mat-form-field>
  
							</mat-expansion-panel>
						</ng-container>
					  </mat-accordion>
		
				</mat-expansion-panel>

				<mat-expansion-panel style="margin-bottom: 0.6vh;">
					<mat-expansion-panel-header>
						<mat-panel-title>
							Grade Mapping Section
						</mat-panel-title>
					</mat-expansion-panel-header>
					<mat-accordion cdkDropList 
						class="example-list" 
						(cdkDropListDropped)="dropGradeHandler($event)" *ngIf="layoutGradeList.length != 0 ">
						  <mat-expansion-panel class="example-box" *ngFor="let layoutGrade of layoutGradeList" cdkDrag>
						  	<mat-expansion-panel-header>
						  		<mat-panel-title>
		  					  		{{getGrade(layoutGrade.parentGrade).name}}
						  		</mat-panel-title>
						  	</mat-expansion-panel-header>
		  					  <p>
		  					  	<span *ngIf="getLayoutSubGradeList(getGrade(layoutGrade.parentGrade)).length!==0; else emptySubGradesElseBlock">
		  					  		<i>Mapped sub grades:</i>
		  					  	</span>
		  					  	<ng-template #emptySubGradesElseBlock>
		  					  		<span style="color:red">No sub grades mapped</span>
		  					  	</ng-template>
		  					  	
		  					  </p>

		  					  <mat-card *ngFor="let layoutSubGrade of getLayoutSubGradeList(getGrade(layoutGrade.parentGrade))">
		  					  		{{getSubGrade(layoutSubGrade.parentSubGrade)["name"]}}
		  					  		<span style="color:red;float: right;cursor: default;" (click)="removeLayoutSubGrade(layoutSubGrade)">
		  					  			Remove
		  					  		</span>
		  					  </mat-card>

		  					  <mat-form-field>
		  					  	<mat-label>Add Sub grade</mat-label>
		  					  	<mat-select (selectionChange)="addLayoutSubGrade($event.value, layoutGrade)">
		  					  		<mat-option *ngFor="let subGrade of getRemainingSubGradeList(getGrade(layoutGrade.parentGrade))" [value]="subGrade">
		  					  			{{subGrade.name}}
		  					  		</mat-option>
		  					  	</mat-select>
								</mat-form-field>
								<button class="btn btn-danger" (click)="removeLayoutGrade(layoutGrade)" style="float: right;">
									Remove
								</button>
								

						  </mat-expansion-panel>
					
					</mat-accordion>

					<br>
					<mat-form-field>
						<mat-label>Avaliable Grades</mat-label>
						<mat-select (selectionChange)="addLayoutGrade($event.value)">
							<mat-option *ngFor="let grade of getRemainingGradeList()" [value]="grade">
								{{grade.name}}
							</mat-option>
						</mat-select>
					</mat-form-field>			

				</mat-expansion-panel>

				<mat-expansion-panel style="margin-bottom: 0.6vh">

					<mat-expansion-panel-header>
						<mat-panel-title>
							Footer Mapping Section
						</mat-panel-title>
					</mat-expansion-panel-header>

					<div>
						<mat-checkbox [ngModel]="currentLayout.remarksOrderNumber" (ngModelChange)="currentLayout.remarksOrderNumber=1-currentLayout.remarksOrderNumber">
							Show remarks
						</mat-checkbox>
					</div>

					<div cdkDropList 
						class="example-list" 
						(cdkDropListDropped)="dropFooterHandler($event)">
						<ng-container *ngFor="let footer_key of getCurrentFooterList()">
							<div class="example-box" cdkDrag>
								{{STUDENT_DETAILS_FOOTER[footer_key]}}
								<span style="float:right;cursor: default;" (click)="removeFooterKey(footer_key)">
									remove
								</span>
							</div>	
						</ng-container>
					</div>

					<div>
						<mat-form-field>
							<mat-label>Add new Footer paramter</mat-label>
							<mat-select (selectionChange)="addFooterKey($event.value)">
								<ng-container *ngFor="let footer_key of getRemainingFooterList()">
									<mat-option [value]="footer_key">
										{{STUDENT_DETAILS_FOOTER[footer_key]}}
									</mat-option>
								</ng-container>
							</mat-select>
						</mat-form-field>
					</div>
				</mat-expansion-panel>
			</mat-accordion>

			<mat-card>
				
				<div>
					<!-- Reset Layout button -->
					<button class="btn btn-danger" (click)="resetCurrentLayout()">
						Reset
					</button>	
					
					<!-- Save Layout button -->
					<button class="btn btn-{{user.activeSchool.secondaryThemeColor}}" *ngIf="currentLayout && !currentLayout.id" (click)="serviceAdapter.createOrUpdateLayout()" >
						Save
					</button>

					<!-- Update Layout button -->
					<button class="btn btn-{{user.activeSchool.secondaryThemeColor}}" *ngIf="currentLayout && currentLayout.id" (click)="serviceAdapter.createOrUpdateLayout()">
						Update
					</button>
					
					<!-- Delete Layout button -->
					<button class="btn btn-danger" *ngIf="currentLayout && currentLayout.id != 0" (click)="serviceAdapter.deleteLayout()">
						Delete
					</button>

				</div>
				
			</mat-card>
			
		</div>

<!-------------------------------------------------------- Preview section -------------------------------------------------------->
<!-------------------------------------------------------- Preview section -------------------------------------------------------->
<!-------------------------------------------------------- Preview section -------------------------------------------------------->

		<div class="col-xs-6" style="height: 100%; display: flex; justify-content: center;">

			<!-- Preview div starts -->
			<div style="height: 75vh; width: 53.04vh; font-size: 8px;">
				<custom-report-card [user]=user 
				[layout]="currentLayout" [layoutExamColumnList]="layoutExamColumnList" [layoutGradeList]="layoutGradeList" [layoutSubGradeList]="layoutSubGradeList" 
				[studentList]="studentList" [studentSectionList]="studentSectionList" [studentSubGradeList]="getStudentSubGradeList()" [studentTestList]="getStudentTestList()" [studentRemarksList]="getStudentRemarksList()" [studentAttendanceList]="getStudentAttendanceList()" 
				[subjectList]="getSubjectList()" [classSubjectList]="getClassSubjectList()" [studentSubjectList]="getStudentSubjectList()" 
				[sessionList]="sessionList" [classList]="classList" [divisionList]="divisionList" [gradeList]="gradeList" [subGradeList]="subGradeList" [examinationList]="examinationList" [testList]="getTestList()" [classTeacherSignatureList]="getClassTeacherSignatureList()"
				></custom-report-card>
			</div>
			
			 <!-- Preview div ends -->
		</div>
	</div>

</div>

<!-- 
Other in 1/3 column
REmarks: Below footer section complete row

Show check box to user, if checked then take attendance start and end date and show in position of attendance orderNumber -->