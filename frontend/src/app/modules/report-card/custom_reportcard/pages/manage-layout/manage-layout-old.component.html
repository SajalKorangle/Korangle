<div class="card-content" style="height: 85vh;">

	<div class="row" *ngIf="!isLoading && examinationList.length == 0">
		<div class="col-md-12" *ngIf="examinationList.length == 0">
			No examination created.
		</div>
	</div>

	<div class="row" *ngIf="!isLoading && examinationList.length != 0" style="height: 100%;overflow: auto;">
		

		<!-- Parameter Section  -->
		<div class="col-xs-6" style="height: 100%; overflow: auto;">

			<!-- Existing layouts dropdown -->
			<mat-card *ngIf="layoutList.length != 0" style="margin-bottom: 0.5vh">
				<mat-form-field>
					<mat-label>
						Edit existing Layout
					</mat-label>
					<mat-select (onChange)="initializeLayoutHandler($event)">
						<mat-option *ngFor="let layout of layoutList" [value]="layout">
							{{layout.name}}
						</mat-option>
					</mat-select>
				</mat-form-field>
			</mat-card>

			<mat-card *ngIf="currentLayoutHandler != null">
				<p>Customised Report Card</p>
				<div class="row">
					<mat-form-field class="col-md-6">
						<span style="color:red" *ngIf="layoutList.find(layout => layout.name === currentLayoutHandler.name)" class="small">
							Layout name must be unique
						</span>
						<mat-label>
							Layout Name
						</mat-label>
						<input matInput placeholder="Enter Layout Name" [(ngModel)]="currentLayoutHandler.name" required>
					</mat-form-field>

					<mat-form-field class="col-md-6">
						<mat-label>Report Card Heading</mat-label>
						<input matInput
						          [(ngModel)]="currentLayoutHandler.reportCardHeading">
					</mat-form-field>

					<div class="col-md-12" style="box-sizing: border-box;">
						<mat-checkbox [(ngModel)]="currentLayoutHandler.showLetterHeadImage">
							Use school Letterhead
						</mat-checkbox>
					</div>

					<div class="col-md-12" *ngIf="currentLayoutHandler.attendanceOrderNumber!==0">
						<div class="row">
							<mat-form-field class="col-md-6">
								<mat-label>Start date</mat-label>
								<input matInput type="date" [(ngModel)]="selectedLayout.layout.attendanceStartDate">
							</mat-form-field>
							<mat-form-field class="col-md-6">
								<mat-label>End date</mat-label>
								<input matInput type="date" [(ngModel)]="selectedLayout.layout.attendanceEndDate">
							</mat-form-field>
						</div>
					</div>
				</div>


			</mat-card>

			<br>

			<mat-accordion *ngIf="currentLayoutHandler" multi="false">
				<mat-expansion-panel style="margin-bottom:0.6vh;">
					<mat-expansion-panel-header>
						<mat-panel-title>
							Student Header Mapping Section
						</mat-panel-title>
					</mat-expansion-panel-header>

					<!-- Student Detail Header Parameter -->
					<div cdkDropList 
						class="example-list" 
						(cdkDropListDropped)="dropHeaderHandler($event)">
						<div class="example-box" cdkDrag *ngFor="let header_key of STUDENT_DETAILS_HEADER_KEYS.filter(item => currentLayoutHandler[item]!==0).sort((a,b)=>currentLayoutHandler[a]<currentLayoutHandler[b])">
							{{STUDENT_DETAILS_HEADER[header_key]}}
							<span style="float:right;cursor: default;color:red" (click)="removeHeaderKey(header_key)">
								Remove
							</span>
						</div>
					</div>

					<div>
						<mat-form-field>
							<mat-label>Add new Header paramter</mat-label>
							<mat-select (selectionChange)="addStudentHeader($event.value)">
								<ng-container *ngFor="let header_key of STUDENT_DETAILS_HEADER_KEYS.filter(item => currentLayoutHandler[item]==0)">
									<mat-option [value]="header_key">
										{{STUDENT_DETAILS_HEADER[header_key]}}
									</mat-option>
								</ng-container>
							</mat-select>
						</mat-form-field>
					</div>	
				</mat-expansion-panel>

				<!-- Examination Header Section -->
				<mat-expansion-panel style="margin-bottom: 0.6vh;">
					<mat-expansion-panel-header >
						<mat-panel-title>
							Examination Mapping Section		
						</mat-panel-title>
					</mat-expansion-panel-header>

					<!-- Subject Count input -->
					<div>
						<mat-form-field class="col-xs-6" matTooltip="Number of subjects to be shown for preview" matTooltipPosition="above">
							<label>Max. of Subjects</label>
							<input matInput type="number" min="0" max="10" step="1" [(ngModel)]="subjectsToShow" />
						</mat-form-field>

						<mat-form-field class="col-xs-6">
							<label>Decimal place</label>
							<input matInput type="number" min="0" max="2" step="1" [(ngModel)]="decimalPlaces">
						</mat-form-field>
					</div>

					<!-- LayoutExamColumn  parameter -->
					<mat-accordion cdkDropList class="example-list" (cdkDropListDropped)="dropExamHandler($event)">
					  <ng-container *ngFor="let layoutExamColumn of currentLayoutHandler.layoutExamColumnHandlers">
						  <mat-expansion-panel class="example-box" cdkDrag>
						  		<mat-expansion-panel-header>
						  			<mat-panel-title>
										  <!-- {{getExaminationName(layoutExam.parentExamination)}} -->
										{{layoutExamColumn.parentExamination}}
						  			</mat-panel-title>
						  		</mat-expansion-panel-header>

						  		<mat-form-field>
						  			<mat-label>
						  				Report card exam name
						  			</mat-label>
						  			<input matInput [(ngModel)]="layoutExamColumn.name">
						  		</mat-form-field>
						  		
						  		<button class="btn btn-danger" (click)="removeLayoutExamColumn(layoutExamColumn)" style="float: right;">
						  			Remove
						  		</button>

						  		<mat-form-field>
						  			<mat-label>Column Type</mat-label>
						  			<mat-select [(value)]="layoutExamColumn.columnType">
						  				<mat-option *ngFor="let exam_type of EXAM_COLUMN_TYPE" [value]="exam_type">
						  					{{exam_type}}
						  				</mat-option>
						  			</mat-select>
						  		</mat-form-field>

						  		<mat-form-field>
									<mat-label *ngIf="layoutExamColumn.columnType.split('/').length == 2">
										{{layoutExamColumn.columnType.split('/')[0]}}  Maximum Marks
						  			</mat-label>
						  			<mat-label *ngIf="layoutExamColumn.columnType.split('/').length == 1">
						  				Maximum Marks
						  			</mat-label>
						  			<input matInput type="number" min="0" [(ngModel)]="layoutExamColumn.maximumMarksObtainedOne">
						  		</mat-form-field>

						  		<mat-form-field *ngIf="layoutExamColumn.columnType.split('/').length == 2">
						  			<mat-label>
						  				{{layoutExamColumn.columnType.split('/')[1]}} Maximum Marks
						  			</mat-label>
						  			<input matInput type="number" min="0" [(ngModel)]="layoutExamColumn.maximumMarksObtainedTwo">
						  		</mat-form-field>

						  </mat-expansion-panel>
					  </ng-container>
					</mat-accordion>
					<!-- Examination List -->
					<mat-form-field>
						<mat-label>Select Examination to map</mat-label>
						<mat-select (selectionChange)="addExamColumn($event.value)">
							<ng-container *ngFor="let examination of examinationList.filter(examination => !currentLayoutHandler.layoutExamColumnHandlers.find(examColumn => examColumn.parentExamination===examination.id))" >
								<mat-option [value]="examination">
									{{examination.name}}
								</mat-option>
							</ng-container>
						</mat-select>
					</mat-form-field>
		
				</mat-expansion-panel>
					<!-- Grade List  -->
				<mat-expansion-panel style="margin-bottom: 0.6vh;">

					<mat-expansion-panel-header>
						<mat-panel-title>
							Grade Mapping Section
						</mat-panel-title>
					</mat-expansion-panel-header>


					<mat-accordion cdkDropList 
						class="example-list" 
						(cdkDropListDropped)="dropGradeHandler($event)" *ngIf="currentLayoutHandler.layoutGradeHandlers.length != 0 ">
						  <mat-expansion-panel class="example-box" *ngFor="let layoutGradeHandler of currentLayoutHandler.layoutGradeHandlers;" cdkDrag>
						  	<mat-expansion-panel-header>
						  		<mat-panel-title>
		  					  		{{layoutGradeHandler.parentGrade}}
						  		</mat-panel-title>
						  	</mat-expansion-panel-header>
		  					  <p>
		  					  	<span *ngIf="layoutGradeHandler.layoutSubGradeHandlers.length != 0; else emptySubGradesElseBlock">
		  					  		<i>Mapped sub grades:</i>
		  					  	</span>
		  					  	<ng-template #emptySubGradesElseBlock>
		  					  		<span style="color:red">No sub grades mapped</span>
		  					  	</ng-template>
		  					  	
		  					  </p>

		  					  <mat-card *ngFor="let layoutSubGradeHandler of layoutGradeHandler.layoutSubGradeHandlers">
		  					  		{{subGradeList.find(subGrade => subGrade.id===layoutSubGradeHandler.parentSubGrade)["name"]}}
		  					  		<span style="color:red;float: right;cursor: default;" (click)="removeLayoutSubGrade(layoutSubGradeHandler, layoutGradeHandler)">
		  					  			Remove
		  					  		</span>
		  					  </mat-card>

		  					  <mat-form-field>
		  					  	<mat-label>Add Sub grade</mat-label>
		  					  	<mat-select (selectionChange)="addSubGradeHandler($event.value, layoutGradeHandler)">
		  					  		<mat-option *ngFor="let subGrade of subGradeList.filter(subGrade => subGrade.parentGrade===layoutGradeHandler.parentGrade &&!layoutGradeHandler.layoutSubGradeHandlers.find(layoutSubGradeHandler => layoutSubGradeHandler.parentSubGrade===subGrade.id))" [value]="subGrade">
		  					  			{{subGrade.name}}
		  					  		</mat-option>
		  					  	</mat-select>
		  					  </mat-form-field>

						  </mat-expansion-panel>
					
					</mat-accordion>

					<br>
					<mat-form-field>
						<mat-label>Avaliable Grades</mat-label>
						<mat-select (selectionChange)="addGradeHandler($event.value)">
							<mat-option *ngFor="let grade of gradeList.filter(grade => currentLayoutHandler.layoutGradeHandlers.find(x => x.parentGrade===grade.id))" [value]="grade">
								{{grade.name}}
							</mat-option>
						</mat-select>
					</mat-form-field>
				

				</mat-expansion-panel>

				<!-- Student Detail Footer section -->
				<mat-expansion-panel style="margin-bottom: 0.6vh">

					<mat-expansion-panel-header>
						<mat-panel-title>
							Footer Mapping Section
						</mat-panel-title>
					</mat-expansion-panel-header>

					<div>
						<mat-checkbox [ngModel]="currentLayoutHandler.remarksOrderNumber" (ngModelChange)="currentLayoutHandler.remarksOrderNumber=1-currentLayoutHandler.remarksOrderNumber">
							Show remarks
						</mat-checkbox>
					</div>

					<div cdkDropList 
						class="example-list" 
						(cdkDropListDropped)="dropFooterHandler($event)">
						<ng-container *ngFor="let footer_key of STUDENT_DETAILS_FOOTER_KEYS.filter(item => currentLayoutHandler[item]!==0).sort((a,b)=>currentLayoutHandler[a]<currentLayoutHandler[b])">
							<div class="example-box" cdkDrag>
								{{STUDENT_DETAILS_FOOTER[footer_key]}}
								<span style="float:right;cursor: default;" (click)="removeFooterKey(footer_key)">
									remove
								</span>
							</div>	
						</ng-container>
					</div>

					<div>
						<mat-form-field>
							<mat-label>Add new Footer paramter</mat-label>
							<mat-select (selectionChange)="addFooterKey($event.value)">
								<ng-container *ngFor="let footer_key of STUDENT_DETAILS_FOOTER_KEYS.filter(item => currentLayoutHandler[item]==0)">
									<mat-option [value]="footer_key">
										{{STUDENT_DETAILS_FOOTER[footer_key]}}
									</mat-option>
								</ng-container>
							</mat-select>
						</mat-form-field>
					</div>
				</mat-expansion-panel>
			</mat-accordion>
			

			<mat-card>
				
				<div>
					<!-- Reset Layout button -->
					<button class="btn btn-danger" (click)="resetCurrentLayout()">
						Reset
					</button>	
					
					<!-- Save Layout button -->
					<button class="btn btn-{{user.activeSchool.secondaryThemeColor}}" *ngIf="currentLayoutHandler && currentLayoutHandler.id == 0" (click)="serviceAdapter.createNewLayout()" >
						Save
					</button>

					<!-- Update Layout button -->
					<button class="btn btn-{{user.activeSchool.secondaryThemeColor}}" *ngIf="currentLayoutHandler && currentLayoutHandler.id != 0" (click)="serviceAdapter.updateLayout()">
						Update
					</button>
					
					<!-- Delete Layout button -->
					<button class="btn btn-danger" *ngIf="currentLayoutHandler && currentLayoutHandler.id != 0" (click)="serviceAdapter.deleteLayout()">
						Delete
					</button>

				</div>
				
			</mat-card>
			
		</div>

<!-------------------------------------------------------- Preview section -------------------------------------------------------->
<!-------------------------------------------------------- Preview section -------------------------------------------------------->
<!-------------------------------------------------------- Preview section -------------------------------------------------------->

		<div class="col-xs-6" style="height: 100%; font-size: 10px; padding: 0 7em">

			<!-- Preview div starts -->
			<!-- <custom-report-card [user]=user [layout]="selectedLayout.layout"></custom-report-card> -->
			 <!-- Preview div ends -->
		</div>
	</div>

	<ng-container *ngIf="isLoading">
        <app-loading-spinner [user]="user"></app-loading-spinner>
    </ng-container>


</div>

<!-- 
Other in 1/3 column
REmarks: Below footer section complete row

Show check box to user, if checked then take attendance start and end date and show in position of attendance orderNumber -->