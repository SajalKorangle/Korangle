<div class="card-content table-responsive" *ngIf="!htmlAdapter.isLoading; else spinner">

    <!-- Choose to add/edit/delete layout/s -->
    <mat-form-field style="margin-bottom: 10px;">
        <mat-select placeholder="Choose to add/edit/delete layout/s"
                    [ngModel]="currentLayout"
                    (ngModelChange)="populateCurrentLayoutWithGivenValue($event);">
            <mat-option [value]="ADD_LAYOUT_STRING">{{ADD_LAYOUT_STRING}}</mat-option>
            <mat-option *ngFor="let layout of reportCardLayoutList;" [value]="layout">{{layout.name}}</mat-option>
        </mat-select>
    </mat-form-field>

    <ng-container *ngIf="currentLayout">
    <mat-card>
        <div>
        <mat-form-field style="width: 100%; max-width: 250px;">
            <mat-label>
                Layout Name
            </mat-label>
            <input matInput [(ngModel)]="currentLayout.name">
            <mat-icon matSuffix *ngIf="doesCurrentLayoutHasUniqueName()"><span class="matrial-icons">emoji_emotions</span></mat-icon>
            <mat-hint style="color:red; display: block;" *ngIf="!doesCurrentLayoutHasUniqueName()" class="small">
                Layout name must be unique
            </mat-hint>
        </mat-form-field>

        <button *ngIf="currentLayout.id"
                class="btn material-icons"
                (click)="serviceAdapter.deleteCurrentLayout()"
                style="padding: 4px 7px; margin-right: 12px; float: right;">delete</button>

        <button class="btn"
                (click)="resetCurrentLayout()"
                style="padding: 4px 7px; margin-right: 12px; float: right;">Reset All</button>

        </div>

        <div class="bg-grey flex-row" style="width: 100%; padding: 6px; margin-top: 6px;">
            <!-- Top Toolbar -->

            <div class="tool"> <!--Background Color Picker-->   
                    <label>Background Color: </label>
                    <input type="color" [value]="canvasAdapter.backgroundColor" (input)="canvasAdapter.applyBackground($event.target.value)"/>
            </div>

            <div class="tool">  <!--Add Image-->
                <input type='file' (change)="imageUploadHandler($event)" multiple="false" style="display: none" accept="image/x-png,image/jpeg" #imageInput/>
                <button class="btn material-icons"
                        (click)="imageInput.click()">add_photo_alternate</button>
            </div>

            <div class="tool">
                <button class="btn material-icons"
                        (click)="htmlAdapter.isSaving=true; saveLayout();" [disabled]="htmlAdapter.isSaving">save</button>
            </div>

            <div class="tool">
                <button class="btn material-icons"
                        (click)="canvasAdapter.scheduleCanvasReDraw(0)" [disabled]="htmlAdapter.isSaving">refresh</button>
            </div>

        </div>

        <div class="flex-row" style="margin-top: 8px; width: 100%; justify-content: space-around;">
            <!-- column1: Left Pannel -->
            <div class="inline-block" style="width: 240px;" class="leftPannel bg-grey">
                <mat-button-toggle-group style="width: 100%; margin-top: 2px;">
                    <mat-button-toggle value="layers" [checked]="htmlAdapter.activeLeftColumn === 'layers'"  (click)="htmlAdapter.activeLeftColumn = 'layers'">Layers</mat-button-toggle>
                    <mat-button-toggle value="parameters" (click)="htmlAdapter.activeLeftColumn = 'parameters'">Parameters</mat-button-toggle>
                </mat-button-toggle-group>

                <!-- Layers Column -->
                <ng-container *ngIf="htmlAdapter.activeLeftColumn === 'layers'">
                    <div style="width: 100%; height: 100%; margin-top: 4px;" class="flex-column">
                        <ng-container *ngFor="let layer of canvasAdapter.layers; index as i">
                            <span *ngIf="layer"
                                    (click)="canvasAdapter.updateActiveLayer(i);"
                                    style="width: calc(100% - 8px); text-align: center; margin: 4px; padding: 4px; border-radius: 3px; cursor: pointer; white-space: nowrap;" 
                                    [class]="i==canvasAdapter.activeLayerIndex?'bg-active':'bg-white'"> 
                                <span (blur)="layer.displayName=$event.target.innerText" style="display: inline-block;" contenteditable="true"> {{layer.displayName}} </span>   <!--this is layer name-->
                                <span style="float: right; margin-right: 12px;">#{{i}}</span>   <!-- i is id which is the array index no.of layers -->
                            </span>
                        </ng-container>
                    </div>
                </ng-container>

                <!-- Parameters -->
                <ng-container *ngIf="htmlAdapter.activeLeftColumn === 'parameters'">

                </ng-container>
            </div>

            <!-- column 2 -->
            <div class="bg-grey inline-block" style="width: calc(100% - 430px); position: relative;" id="canvasWrapper">
                <ng-container *ngIf="htmlAdapter.isSaving"><mat-progress-bar mode="indeterminate" style="position: absolute;"></mat-progress-bar></ng-container>
                <canvas id="mainCanvas" [style.margin.px]="htmlAdapter.canvasMargin"></canvas>
            </div>


            <!-- column 3 -->
            <div class="inline-block" style="width: 160px;">
                Right pannel
            </div>

        </div>
    </mat-card>
    </ng-container>

</div>

<ng-template #spinner>
    <app-loading-spinner [user]="user"></app-loading-spinner>
</ng-template>
