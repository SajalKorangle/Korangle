<div class="card-content main-page" style="height: 90vh">
    <ng-container *ngIf="!isLoading; else spinner">
        <mat-form-field style="margin-right: 15px">
            <mat-select placeholder="Select Class">
                <mat-option>
                    <button class="btn" style="padding: 4px 7px" (click)="selectAllClasses(); $event.stopPropagation()">Select All</button>
                    <button class="btn" style="padding: 4px 7px" (click)="unselectAllClasses(); $event.stopPropagation()">Clear All</button>
                </mat-option>

                <ng-container *ngFor="let classSection of classSectionList">
                    <mat-option style="width: 100%">
                        <mat-checkbox [(ngModel)]="classSection.selected" (click)="$event.stopPropagation()">
                            {{ classSection.class.name }}{{ classSection.showDivision ? ', ' + classSection.section.name : '' }}
                        </mat-checkbox>
                    </mat-option>
                </ng-container>

                <mat-option>
                    <button class="btn" style="padding: 4px 7px" (click)="selectAllClasses(); $event.stopPropagation()">Select All</button>
                    <button class="btn" style="padding: 4px 7px" (click)="unselectAllClasses(); $event.stopPropagation()">Clear All</button>
                </mat-option>
            </mat-select>
        </mat-form-field>

        <mat-form-field style="margin-right: 15px; float: right">
            <mat-select placeholder="Select Columns">
                <ng-container *ngFor="let col of getColumnKeys()">
                    <mat-option style="width: 100%">
                        <mat-checkbox [(ngModel)]="columnsList[col]" (click)="$event.stopPropagation()">
                            {{ col }}
                        </mat-checkbox>
                    </mat-option>
                </ng-container>
            </mat-select>
        </mat-form-field>

        <div class="responsive-table-wrapper">
            <table class="table table-hover">
                <thead class="text-{{ user.activeSchool.secondaryThemeColor }}">
                    <tr>
                        <th *ngIf="columnsList['Certificate No.']">Certificate No.</th>
                        <th *ngIf="columnsList['Scholar No.']">Scholor No.</th>
                        <th *ngIf="columnsList['Name']">Name</th>
                        <th *ngIf="columnsList['Class Section']">Class & Section</th>
                        <th *ngIf="columnsList['Last Class Passed']">Last Class Passed</th>
                        <th *ngIf="columnsList['Father\'s Name']">Father's Name</th>
                        <th *ngIf="columnsList['Date Of Admission']">Date Of Admission</th>
                        <th *ngIf="columnsList['Issue Date']">Issue Date</th>
                        <th *ngIf="columnsList['Leaving Date']">Leaving Date</th>
                        <th *ngIf="columnsList['Status']">Status</th>
                        <th *ngIf="columnsList['Generated By']">Generated By</th>
                        <th *ngIf="columnsList['Issued By']">Issued By</th>
                        <th *ngIf="columnsList['Cancelled By']">Cancelled By</th>
                        <th *ngIf="columnsList['Certificate']">Certificate</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngIf="getFilteredStudentSectionList().length == 0">
                        <td>No TC available</td>
                    </tr>
                    <ng-container *ngFor="let ss of getFilteredStudentSectionList()">
                        <tr>
                            <td *ngIf="columnsList['Certificate No.']">{{ ss.tc.certificateNumber }}</td>
                            <td *ngIf="columnsList['Scholar No.']">{{ ss.parentStudentInstance.scholarNumber }}</td>
                            <td *ngIf="columnsList['Name']">{{ ss.parentStudentInstance.name }}</td>
                            <td *ngIf="columnsList['Class Section']">{{ getClassSectionName(ss.parentClass, ss.parentDivision) }}</td>
                            <td *ngIf="columnsList['Last Class Passed']">{{ ss.tc.lastClassPassed }}</td>
                            <td *ngIf="columnsList['Father\'s Name']">{{ ss.parentStudentInstance.fathersName }}</td>
                            <td *ngIf="columnsList['Date Of Admission']">{{ ss.parentStudentInstance.dateOfAdmission | localDate }}</td>
                            <td *ngIf="columnsList['Issue Date']">{{ ss.tc.issueDate | localDate }}</td>
                            <td *ngIf="columnsList['Leaving Date']">{{ ss.tc.leavingDate | localDate }}</td>
                            <td *ngIf="columnsList['Status']">{{ ss.tc.status }}</td>
                            <td *ngIf="columnsList['Generated By']">{{ getEmployeeName(ss.tc.generatedBy) }}</td>
                            <td *ngIf="columnsList['Issued By']">{{ getEmployeeName(ss.tc.issuedBy) }}</td>
                            <td *ngIf="columnsList['Cancelled By']">{{ getEmployeeName(ss.tc.cancelledBy) }}</td>
                            <td *ngIf="columnsList['Certificate']">
                                <a [href]="ss.tc.certificateFile" target="_blank">
                                    <mat-icon>description</mat-icon>
                                </a>
                            </td>
                        </tr>
                    </ng-container>
                </tbody>
            </table>
        </div>
    </ng-container>

    <ng-template #spinner>
        <app-loading-spinner [user]="user"></app-loading-spinner>
    </ng-template>
</div>