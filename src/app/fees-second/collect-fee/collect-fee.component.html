<div class="main-content">
    <div class="container-fluid">

        <div class="card" style="min-height: 100%">
            <div class="card-header" [attr.data-background-color]="user.color">
                <h4 class="title">Collect Fee</h4>
            </div>
            <div class="card-content">

                <app-student-filter [user]="user" (onStudentSelected)="getStudentFeeStatus($event)"></app-student-filter>

                <ng-container *ngIf="this.studentFeeStatus && !isLoading">

                    <ng-container *ngIf="getStudentFeesDue()>0">
                        <table class="table table-hover" style="font-weight: 800 !important;">
                            <thead class="text-{{user.btn_color}}">
                                <tr>
                                    <th colspan="3"></th>
                                    <th class="text-right" style="padding-right: 25px;">Payment</th>
                                    <th class="text-right">Due</th>
                                    <th class="text-right">Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td colspan="3">{{selectedStudent.name}}</td>
                                    <td class="text-right"><input class='paymentInput'
                                                                  type="number" min="0"
                                                                  [attr.max]="getStudentFeesDue()"
                                                                  [ngModel]="getStudentPayment()==0?null:getStudentPayment()"
                                                                  (keypress)="policeStudentPaymentInput($event)"
                                                                  (ngModelChange)="handleStudentPaymentChange($event);"></td>
                                    <td class="text-right">{{getStudentFeesDue()-getStudentPayment()}}</td>
                                    <td class="text-right">{{getStudentTotalFee()}}</td>
                                </tr>
                                <ng-container *ngFor="let sessionFeeStatus of studentFeeStatus.sessionFeeStatusList; let i=index;">
                                    <ng-container *ngIf="getSessionFeesDue(sessionFeeStatus)>0">
                                        <!-- tr *ngIf="studentFeeStatus.sessionFeeStatusList.length > 1" -->
                                        <tr>
                                            <td>{{i+1}}.</td>
                                            <td colspan="2">{{sessionFeeStatus.sessionName}}</td>
                                            <td class="text-right"><input class='paymentInput'
                                                                          type="number" min="0"
                                                                          [attr.max]="getSessionFeesDue(sessionFeeStatus)"
                                                                          [ngModel]="getSessionPayment(sessionFeeStatus)==0?null:getSessionPayment(sessionFeeStatus)"
                                                                          (keypress)="policeSessionPaymentInput(sessionFeeStatus, $event)"
                                                                          (ngModelChange)="handleSessionPaymentChange(sessionFeeStatus, $event);"></td>
                                            <td class="text-right">{{getSessionFeesDue(sessionFeeStatus)-getSessionPayment(sessionFeeStatus)}}</td>
                                            <td class="text-right">{{getSessionTotalFee(sessionFeeStatus)}}</td>
                                        </tr>
                                        <ng-container *ngFor="let component of sessionFeeStatus.componentList; let i=index;">
                                            <tr>
                                                <td></td>
                                                <td>{{i+1}}.</td>
                                                <td>{{component.feeType}}</td>
                                                <td class="text-right"><input class='paymentInput'
                                                                              type="number" min="0"
                                                                              [attr.max]="getComponentFeesDue(component)"
                                                                              [ngModel]="getComponentPayment(component)==0?null:getComponentPayment(component)"
                                                                              (keypress)="policeComponentPaymentInput(component, $event)"
                                                                              (ngModelChange)="handleComponentPaymentChange(component, $event);"></td>
                                                <td class="text-right">{{getComponentFeesDue(component)-getComponentPayment(component)}}</td>
                                                <td class="text-right">{{getComponentTotalFee(component)}}</td>
                                            </tr>
                                            <ng-container *ngIf="component.frequency == 'MONTHLY'">
                                                <ng-container *ngFor="let month of component.monthList">
                                                    <tr *ngIf="getComponentMonthlyTotalFee(month)>0">
                                                        <td></td>
                                                        <td></td>
                                                        <td>{{month.month}}</td>
                                                        <td class="text-right">{{getComponentMonthlyPayment(month)}}</td>
                                                        <td class="text-right">{{getComponentMonthlyFeesDue(month)-getComponentMonthlyPayment(month)}}</td>
                                                        <td class="text-right">{{getComponentMonthlyTotalFee(month)}}</td>
                                                    </tr>
                                                </ng-container>
                                            </ng-container>
                                        </ng-container>
                                    </ng-container>
                                </ng-container>
                            </tbody>
                        </table>
                    </ng-container>

                    <ng-container *ngIf="getStudentTotalFee() === 0">
                        **No Fees Due
                    </ng-container>

                </ng-container>


            </div>
        </div>

    </div>
</div>
