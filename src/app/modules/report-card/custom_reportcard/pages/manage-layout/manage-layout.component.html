<div class="card-content" style="height: 88vh; overflow: auto">

	<div class="row" *ngIf="!isLoading && examinationList.length == 0">
		<div class="col-md-12" *ngIf="examinationList.length == 0">
			No examination created.
		</div>
	</div>

	<div class="row" style="" *ngIf="!isLoading && examinationList.length != 0" style="height: 100%;overflow: auto;">
		

		<!-- Parameter Section  -->
		<div class="col-xs-6" style="height: 100%; overflow: auto;">

			<!-- Existing layouts dropdown -->
			<mat-card *ngIf="layoutList.length != 0" style="margin-bottom: 0.5vh">
				<mat-form-field>
					<mat-label>
						Edit existing Layout
					</mat-label>
					<mat-select (selectionChange)="initializeExistingLayout($event.value);this.$event.value=null">
						<mat-option *ngFor="let layout of layoutList" [value]="layout">
							{{layout.name}}
						</mat-option>
					</mat-select>
				</mat-form-field>
			</mat-card>

			<mat-card *ngIf="selectedLayout != null">
				<p>Customised Report Card</p>
				<div class="row">
					<mat-form-field class="col-md-6">
						<span style="color:red" *ngIf="!isNameUnqiue(selectedLayout,layoutList)" class="small">
							Layout name must be unique
						</span>
						<mat-label>
							Layout Name
						</mat-label>
						<input matInput placeholder="Enter Layout Name" [(ngModel)]="selectedLayout.layout.name" required>
					</mat-form-field>

					<mat-form-field class="col-md-6">
						<mat-label>Report Card Heading</mat-label>
						<input matInput
						          [(ngModel)]="selectedLayout.layout.reportCardHeading">
					</mat-form-field>

					<div class="col-md-12" style="box-sizing: border-box;">
						<mat-checkbox [(ngModel)]="selectedLayout.layout.showLetterHeadImage">
							Use school Letterhead
						</mat-checkbox>
					</div>

					<div class="col-md-12">
						<mat-checkbox [(ngModel)]="selectedLayout.autoAttendance">
							Use software attendance
						</mat-checkbox>
						<div *ngIf="selectedLayout.autoAttendance" class="row">
							<mat-form-field class="col-md-6">
								<mat-label>Start date</mat-label>
								<input matInput type="date" [(ngModel)]="selectedLayout.layout.attendanceStartDate">
							</mat-form-field>
							<mat-form-field class="col-md-6">
								<mat-label>End date</mat-label>
								<input matInput type="date" [(ngModel)]="selectedLayout.layout.attendanceEndDate">
							</mat-form-field>
						</div>
					</div>
				</div>


			</mat-card>

			<br>

			<mat-accordion *ngIf="selectedLayout" multi="false">
				<mat-expansion-panel style="margin-bottom:0.6vh;">
					<mat-expansion-panel-header>
						<mat-panel-title>
							Student Header Mapping Section
						</mat-panel-title>
					</mat-expansion-panel-header>

					<!-- Student Detail Header Parameter -->
					<div cdkDropList 
						class="example-list" 
						(cdkDropListDropped)="drop($event, selectedLayout.selectedStudentDetailsHeader)">
						<ng-container *ngFor="let studentDetail of selectedLayout.selectedStudentDetailsHeader">
							<div class="example-box" cdkDrag>
								{{STUDENT_DETAILS_HEADER[studentDetail]}}
								<span style="float:right;cursor: default;color:red" (click)="removeSelectedStudentHeader(studentDetail)">
									Remove
								</span>
							</div>	
						</ng-container>
					</div>

					<div>
						<mat-form-field>
							<mat-label>Add new Header paramter</mat-label>
							<mat-select (selectionChange)="addStudentHeader($event.value)">
								<ng-container *ngFor="let studentHeaderKey of getFilteredStudentDetailHeader()">
									<mat-option [value]="studentHeaderKey">
										{{STUDENT_DETAILS_HEADER[studentHeaderKey]}}
									</mat-option>
								</ng-container>
							</mat-select>
						</mat-form-field>
					</div>	
				</mat-expansion-panel>

				<!-- Examination Header Section -->
				<mat-expansion-panel style="margin-bottom: 0.6vh;">
					<mat-expansion-panel-header >
						<mat-panel-title>
							Examination Mapping Section		
						</mat-panel-title>
					</mat-expansion-panel-header>

					<!-- Subject Count input -->
					<div>
						<mat-form-field class="col-xs-6" matTooltip="Number of subjects to be shown for preview" matTooltipPosition="above">
							<label>Max. of Subjects</label>
							<input matInput type="number" min="0" max="10" step="1" [value]="subjectCountArray.length" (change)="updateSubjectCountArray($event.target.value)" >
						</mat-form-field>

						<mat-form-field class="col-xs-6">
							<label>Decimal place</label>
							<input matInput type="number" min="0" max="2" step="1" [(ngModel)]="selectedLayout.layout.decimalPlaces">
						</mat-form-field>
					</div>

					<!-- LayoutExamColumn  parameter -->
					<mat-accordion cdkDropList class="example-list" (cdkDropListDropped)="drop($event,selectedLayout.layoutExamColumnList)">
					  <ng-container *ngFor="let layoutExam of selectedLayout.layoutExamColumnList">
						  <mat-expansion-panel class="example-box" cdkDrag>
						  		<mat-expansion-panel-header>
						  			<mat-panel-title>
						  				{{getExaminationName(layoutExam.parentExamination)}}
						  			</mat-panel-title>
						  		</mat-expansion-panel-header>

						  		<mat-form-field>
						  			<mat-label>
						  				Report card exam name
						  			</mat-label>
						  			<input matInput [(ngModel)]="layoutExam.name">
						  		</mat-form-field>
						  		
						  		<button class="btn btn-danger" (click)="removeLayoutExamColumnList(layoutExam)" style="float: right;">
						  			Remove
						  		</button>

						  		<mat-form-field>
						  			<mat-label>Column Type</mat-label>
						  			<mat-select [(value)]="layoutExam.columnType">
						  				<mat-option *ngFor="let exam_type of EXAM_COLUMN_TYPE" [value]="exam_type">
						  					{{exam_type}}
						  				</mat-option>
						  			</mat-select>
						  		</mat-form-field>

						  		<mat-form-field>
						  			<mat-label *ngIf="layoutExam.columnType.split('/').length == 2">					{{layoutExam.columnType.split('/')[0]}}  Maximum Marks
						  			</mat-label>
						  			<mat-label *ngIf="layoutExam.columnType.split('/').length == 1">
						  				Maximum Marks
						  			</mat-label>
						  			<input matInput type="number" min="0" [(ngModel)]="layoutExam.maximumMarksObtainedOne">
						  		</mat-form-field>

						  		<mat-form-field *ngIf="layoutExam.columnType.split('/').length == 2">
						  			<mat-label>
						  				{{layoutExam.columnType.split('/')[1]}} Maximum Marks
						  			</mat-label>
						  			<input matInput type="number" min="0" [(ngModel)]="layoutExam.maximumMarksObtainedTwo">
						  		</mat-form-field>

						  </mat-expansion-panel>
					  </ng-container>
					</mat-accordion>
					<!-- Examination List -->
					<mat-form-field>
						<mat-label>Select Examination to map</mat-label>
						<mat-select (selectionChange)="addExamToMapping($event.value)">
							<ng-container *ngFor="let examination of getFilteredExaminationList()" >
								<mat-option [value]="examination">
										{{examination.name}}
								</mat-option>
							</ng-container>
						</mat-select>
					</mat-form-field>
		
				</mat-expansion-panel>
					<!-- Grade List  -->
				<mat-expansion-panel style="margin-bottom: 0.6vh;">

					<mat-expansion-panel-header>
						<mat-panel-title>
							Grade Mapping Section
						</mat-panel-title>
					</mat-expansion-panel-header>


					<mat-accordion cdkDropList 
						class="example-list" 
						(cdkDropListDropped)="drop($event, selectedLayout.layoutGradeList)" *ngIf="selectedLayout.layoutGradeList.length != 0 ">
						  <mat-expansion-panel class="example-box" *ngFor="let layoutGrade of selectedLayout.layoutGradeList;" cdkDrag>
						  	<mat-expansion-panel-header>
						  		<mat-panel-title>
		  					  		{{getGradeName(layoutGrade.parentGrade)}}
						  		</mat-panel-title>
						  	</mat-expansion-panel-header>
		  					  <p>
		  					  	<span *ngIf="getFilteredLayoutSubGradeList(layoutGrade).length != 0; else emptySubGradesElseBlock">
		  					  		<i>Mapped sub grades:</i>
		  					  	</span>
		  					  	<ng-template #emptySubGradesElseBlock>
		  					  		<span style="color:red">No sub grades mapped</span>
		  					  	</ng-template>
		  					  	
		  					  </p>

		  					  <mat-card *ngFor="let layoutSubGrade of getFilteredLayoutSubGradeList(layoutGrade)">
		  					  		{{getSubGradeName(layoutSubGrade.parentSubGrade)}}
		  					  		<span style="color:red;float: right;cursor: default;" (click)="removeSubGradeMapping(layoutSubGrade)">
		  					  			Remove
		  					  		</span>
		  					  </mat-card>

		  					  <mat-form-field>
		  					  	<mat-label>Add Sub grade</mat-label>
		  					  	<mat-select (selectionChange)="addSubGradeMapping($event.value, layoutGrade)">
		  					  		<mat-option *ngFor="let subGrade of getFilteredSubGradeList(layoutGrade)" [value]="subGrade">
		  					  			{{subGrade.name}}
		  					  		</mat-option>
		  					  	</mat-select>
		  					  </mat-form-field>

						  </mat-expansion-panel>
					
					</mat-accordion>

					<br>
					<mat-form-field>
						<mat-label>Avaliable Grades</mat-label>
						<mat-select (selectionChange)="addGradeMapping($event.value)">
							<mat-option *ngFor="let grade of getFilteredGradeList()" [value]="grade">
								{{grade.name}}
							</mat-option>
						</mat-select>
					</mat-form-field>
				

				</mat-expansion-panel>

				<!-- Student Detail Footer section -->
				<mat-expansion-panel style="margin-bottom: 0.6vh">

					<mat-expansion-panel-header>
						<mat-panel-title>
							Footer Mapping Section
						</mat-panel-title>
					</mat-expansion-panel-header>

					<div>
						<mat-checkbox [ngModel]="selectedLayout.layout.remarksOrderNumber" (ngModelChange)="selectedLayout.layout.remarksOrderNumber=1-selectedLayout.layout.remarksOrderNumber">
							Show remarks
						</mat-checkbox>
					</div>

					<div cdkDropList 
						class="example-list" 
						(cdkDropListDropped)="drop($event, selectedLayout.selectedStudentDetailsFooter)">
						<ng-container *ngFor="let studentDetail of selectedLayout.selectedStudentDetailsFooter">
							<div class="example-box" cdkDrag>
								{{STUDENT_DETAILS_FOOTER[studentDetail]}}
								<span style="float:right;cursor: default;display: inline-block;" (click)="removeSelectedStudentFooter(studentDetail)">
									remove
								</span>
							</div>	
						</ng-container>
					</div>

					<div>
						<mat-form-field>
							<mat-label>Add new Footer paramter</mat-label>
							<mat-select (selectionChange)="addStudentFooter($event.value)">
								<ng-container *ngFor="let studentFooterKey of getFilteredStudentDetailFooter()">
									<mat-option [value]="studentFooterKey">
										{{STUDENT_DETAILS_FOOTER[studentFooterKey]}}
									</mat-option>
								</ng-container>
							</mat-select>
						</mat-form-field>
					</div>
				</mat-expansion-panel>
			</mat-accordion>
			

			<mat-card>
				
				<div>
					<!-- Reset Layout button -->
					<button class="btn btn-danger" (click)="resetCurrentLayout()">
						Reset
					</button>	
					
					<!-- Save Layout button -->
					<button class="btn btn-{{user.activeSchool.secondaryThemeColor}}" *ngIf="selectedLayout && selectedLayout.layout.id == 0" (click)="serviceAdapter.createNewLayout()" >
						Save
					</button>

					<!-- Update Layout button -->
					<button class="btn btn-{{user.activeSchool.secondaryThemeColor}}" *ngIf="selectedLayout && selectedLayout.layout.id != 0" (click)="serviceAdapter.updateLayout()">
						Update
					</button>
					
					<!-- Delete Layout button -->
					<button class="btn btn-danger" *ngIf="selectedLayout && selectedLayout.layout.id != 0" (click)="serviceAdapter.deleteLayout()">
						Delete
					</button>

				</div>
				
			</mat-card>
			
		</div>

<!-------------------------------------------------------- Preview section -------------------------------------------------------->
<!-------------------------------------------------------- Preview section -------------------------------------------------------->
<!-------------------------------------------------------- Preview section -------------------------------------------------------->

		<div class="col-xs-6" style="height: 81.2vh; overflow-y: auto;">

			<!-- Preview div starts -->
			<div class="container-fluid"
			     style="width: 57.75vh; height: 100%;
			     border: 6px double #b87333;
			     position: relative;
			     overflow: hidden;
			     border-radius: 8px;
			     font-weight: 800 !important;
			     font-size:1.5vh;
			     ">
			     
			     
			     <!-- Background Watermark -->
			     <img src="{{user.activeSchool.profileImage}}"
			          style="border-radius: 2px; position: absolute;
			          top: 50%; left: 50%;
			          width: 30vh; height: 30vh;
			          opacity: 0.15 !important;
			          filter: grayscale(100%) !important;
			          z-index: 10;
			          transform: translate(-50%,-50%);
			          -ms-transform: translate(-50%,-50%);"/>

	            <!-- Reg. No. , Dise Code -->
	            <div class="row no-gutters" style="margin-bottom: 0px !important;">
	                <div class="col-xs-6 d-flex custom-padding">
	                    Dise code : {{user.activeSchool.diseCode}}
	                </div>
	                <div class="col-xs-6 d-flex custom-padding" align="end">
	                	<!-- Mp Board -->
	                    <ng-container *ngIf="user.activeSchool.parentBoard==1">
	                        School Code :
	                    </ng-container>
	                    <!-- Cbse board -->
	                    <ng-container *ngIf="user.activeSchool.parentBoard==2">
	                        Affiliation No. :
	                    </ng-container>
	                    {{user.activeSchool.affiliationNumber}}
	                </div>
	            </div>

			     <!-- School name, School profile image, school address -->
			     <div class="row" *ngIf="selectedLayout && selectedLayout.layout.showLetterHeadImage;else showLetterHeadImageElseBlock">
			     	<img src="{{user.activeSchool.profileImage}}" style="width:100%;max-height: 25vh;">
			     </div>
			     <ng-template #showLetterHeadImageElseBlock>
			     	<div class="row">
			     		<div class="col-md-2">
			     			<img src="{{user.activeSchool.profileImage}}" style="">
			     		</div>
			     		<div class="col-md-8" style="line-height: normal !important; margin-top: 5px !important; text-align: center;">
			     			<p style="font-size: 2.8vh; font-weight:800; color: red !important;">
			     				{{user.activeSchool.printName}}	
			     			</p>
			     			<p style="font-size: 2vh;">
			     				{{user.activeSchool.address}}
			     			</p>
			     		</div>
			     		<div class="col-md-2"></div>
			     	</div>
			     </ng-template>


			     <!-- Report Card Heading -->
			     <div class="row no-gutters"  *ngIf="selectedLayout != null" style="margin-top: 3px !important; line-height: normal !important;">
			         <div class="col-xs-12" align="center">
			             <span style="font-size:2.2vh">{{selectedLayout.layout.reportCardHeading}}</span>
			         </div>
			     </div>

			     <!-- Session -->
			     <div class="row no-gutters" style="margin-top: 3px !important; line-height: normal !important;">
			         <div class="col-xs-12" align="center">
			             <span style="font-size: 2vh">{{getSessionName(user.activeSchool.currentSessionDbId)}}</span>
			         </div>
			     </div>

			     <!-- Student Detail header -->
			     <!-- First four rows -->
			     <div class="row" style="font-size: 1.0vh"  *ngIf="selectedLayout != null">
			     	<div class="col-md-10" style="margin-bottom: 0.5vh">
			     		
			     		<ng-container *ngFor="let studentHeaderKey of selectedLayout.selectedStudentDetailsHeader;let i = index">
			     			<ng-container *ngIf="i<=3">
			     				<div style="display:flex;margin-bottom:0.5vh;">
				     				<div style="width:31%; font-weight: bold;">
				     					{{STUDENT_DETAILS_HEADER[studentHeaderKey]}}
				     				</div>
				     				<div style="width: 100%; font-weight: normal;">
				     					{{STUDENT_DETAILS_HEADER[studentHeaderKey]}} Value
				     				</div>
				     			</div>
			     			</ng-container>
			     		</ng-container>

			     	</div>
			     	<div class="col-md-2" style="padding-left:0px;">
			     		<img src="{{user.activeSchool.profileImage}}">
			     	</div>
			     	
			     </div>

			     <!-- Remaining rows -->
			     <div class="row" style="font-size:1.0vh;"  *ngIf="selectedLayout != null">
			     		<ng-container *ngFor="let studentHeaderKey of selectedLayout.selectedStudentDetailsHeader;let i = index">
			     			<ng-container *ngIf="i>3 && i%2 == 0">
			     				<div class="col-md-8" style="display: flex;margin-bottom: 0.5vh">
			     					<div style="width:30%; font-weight: bold;">
			     						{{STUDENT_DETAILS_HEADER[studentHeaderKey]}}
			     					</div>
			     					<div style="width:70%; font-weight: normal">
			     						{{STUDENT_DETAILS_HEADER[studentHeaderKey]}} Value
			     					</div>
			     				</div>
			     			</ng-container>
			     			<ng-container *ngIf="i>3 && i%2 != 0">
			     				<div class="col-md-4" style="display: flex;margin-bottom: 0.5vh;padding-left:0px;">
			     					<div style="width:30%; font-weight: bold">
			     						{{STUDENT_DETAILS_HEADER[studentHeaderKey]}}
			     					</div>
			     					<div style="width:70%;font-weight: normal">
			     						{{STUDENT_DETAILS_HEADER[studentHeaderKey]}} Value
			     					</div>
			     				</div>
			     			</ng-container>
			     		</ng-container>

			     </div>


			     <!-- Examination wing -->
			     <div class="row" *ngIf="selectedLayout && selectedLayout.layoutExamColumnList.length != 0">
			     	<div classs="col-md-12" style="text-align: center;">
			     		<table class="table table-bordered table-responsive" id='examTable'>
			     			<!-- First row -->
			     			<tr>
			     				<td rowspan="2">Subject Name</td>
			     				<ng-container *ngFor="let examination of selectedLayout.layoutExamColumnList">
			     					<ng-container *ngIf="examination.columnType.split('/').length == 1">
			     						<td rowspan="2">
			     							{{examination.name}}
			     						</td>
			     					</ng-container>
			     					<ng-container *ngIf="examination.columnType.split('/').length > 1">
			     						<!-- Added one for total column -->
			     						<td [attr.colspan]="examination.columnType.split('/').length + 1">
			     							{{examination.name}}
			     						</td>
			     					</ng-container>
			     				</ng-container>

			     				<!-- Added for Total for all examinations; Last column of table -->
			     				<ng-container *ngIf="selectedLayout.layoutExamColumnList.length > 1">
			     					<td rowspan="2">
			     						Total
			     					</td>
			     				</ng-container>
			     			</tr>

			     			<!-- Second Row -->
			     			<tr>
			     				<ng-container *ngFor="let examination of selectedLayout.layoutExamColumnList">
			     					<ng-container *ngIf="examination.columnType.split('/').length > 1">
				     					<td   *ngFor="let exam_type of examination.columnType.split('/')">
				     						{{exam_type}}
				     					</td>
				     					<td>
				     						Total
				     					</td>
			     					</ng-container>
			     				</ng-container>
			     			</tr>
			     			<!-- Row for subjects count -->
			     			<tr *ngFor="let subjectNo of subjectCountArray;let i = index">
			     				<td>
			     					Subject-{{i+1}}
			     				</td>
			     				<ng-container *ngFor="let examination of selectedLayout.layoutExamColumnList">
			     					<td *ngFor="let exam_type of examination.columnType.split('/')">
			     						10
			     					</td>
			     					<ng-container *ngIf="examination.columnType.split('/').length > 1">
			     						<!-- Added for total column -->
			     						<td>
			     							10
			     						</td>
			     					</ng-container>
			     				</ng-container>

		     					<ng-container *ngIf="selectedLayout.layoutExamColumnList.length > 1">
			     					<td>
			     						10
			     					</td>
			     				</ng-container>

			     			</tr>
			     			<!-- Total marks row -->
			     			<tr>
			     				<td>
			     					Total
			     				</td>
			     				<ng-container *ngFor="let examination of selectedLayout.layoutExamColumnList">
			     					
			     					<td *ngIf="examination.columnType.split('/').length > 1" [attr.colspan]="examination.columnType.split('/').length + 1" style="text-align: right">
			     						10
			     					</td>
			     					<td *ngIf="examination.columnType.split('/').length == 1" style="text-align: center">
			     						10
			     					</td>
			     				</ng-container>
			     				<ng-container *ngIf="selectedLayout.layoutExamColumnList.length > 1">
			     					<td>
			     						10
			     					</td>
			     				</ng-container>
			     			</tr>

			     			<!-- Total marks in words row -->
			     			<tr>
			     				<!-- TODO: Hanlde its colspan -->
			     				<td [attr.colspan]="getTotalColummnsInExamTable()" style="text-align: left;">
			     					Total( in words):
			     				</td>
			     			</tr>

			     		</table>
			     	</div>
			     </div>


			     <!-- Grade Section -->
			     <ng-container *ngIf="selectedLayout && selectedLayout.layoutGradeList.length != 0">
			     	<div style="border:0px solid black;margin-bottom:1vh" *ngFor="let layoutGrade of selectedLayout.layoutGradeList">
			     		<div class="row" style="border:1px solid lightgrey;border-collapse: collapse;">
	     					{{getGradeName(layoutGrade.parentGrade)}}
			     		</div>

			     		<div class="row">
			     			<div class="col-xs-6" style="border:1px solid lightgrey;border-collapse: collapse;" *ngFor="let layoutSubGrade of getFilteredLayoutSubGradeList(layoutGrade)">
			     				{{getSubGradeName(layoutSubGrade.parentSubGrade)}} - 10
			     			</div>
			     		</div>
			     	</div>
			     </ng-container>

			     <!-- Student Detail Footer Section-->
			     	<div class="row" *ngIf="selectedLayout && selectedLayout.selectedStudentDetailsFooter.length != 0">
				     	<ng-container *ngFor="let studentFooter of selectedLayout.selectedStudentDetailsFooter">
				     		<div class="col-xs-4">
				     			{{STUDENT_DETAILS_FOOTER[studentFooter]}}:
				     			{{STUDENT_DETAILS_FOOTER[studentFooter]}} value
				     		</div>
				     	</ng-container>
			     	</div>
			     	<!-- Remarks Row -->
			     	<div class="row" *ngIf="selectedLayout && selectedLayout.layout.remarksOrderNumber != 0">
			     		Remarks: Some remark will be shown here
			     	</div>

			     	<!-- Teacher and principal signature -->
			     	<div class="row" style="position: absolute;bottom:0;width:100%;">
			     		<div class="col-xs-6" style="text-align: center">
			     			<div>
		     					<img src="{{user.activeSchool.profileImage}}" style="height: 4vh;">
		     				</div>
		     				<div>
		     					Class Teacher Signature
		     				</div>
			     		</div>
			     		<div class="col-xs-6" style="text-align: center">
			     			<div>
		     					<img src="{{user.activeSchool.principalSignatureImage}}" style="height: 4vh;">
		     				</div>
		     				<div>
		     					Principal Signature
		     				</div>
			     		</div>
			     	</div>
			 </div>
			 <!-- Preview div ends -->
		</div>
	</div>

	<ng-container *ngIf="isLoading">
        <app-loading-spinner [user]="user"></app-loading-spinner>
    </ng-container>


</div>

<!-- 
Other in 1/3 column
REmarks: Below footer section complete row

Show check box to user, if checked then take attendance start and end date and show in position of attendance orderNumber -->