<div class="card-content table-responsive">

    <div class="row">
        <div class="col-md-3">
            <div class="form-group form-black label-floating">
                <label class="control-label">Start Date</label>
                <input type="date" class="form-control" [(ngModel)]="startDate">
            </div>
        </div>
        <div class="col-md-3">
            <div class="form-group form-black label-floating">
                <label class="control-label">End Date</label>
                <input type="date" class="form-control" [(ngModel)]="endDate">
            </div>
        </div>
        <div class="col-md-3">
            <button type="button"
                    class="btn btn-{{user.activeSchool.secondaryThemeColor}}"
                    style="padding: 12px 15px"
                    matTooltip="Get all the receipts b/w start and end date"
                    tooltip-position="right"
                    (click)="getSMSList();">
                <i class="material-icons">search</i>
            </button><br>
        </div>
    </div>

    <ng-container *ngIf="!isLoading && smsList">

        <ng-container *ngIf="smsList.length>0">

            <table class="table table-hover visible-sm visible-xs">
                <thead class="text-{{user.activeSchool.secondaryThemeColor}}">
                <tr>
                    <th>S No.</th>
                    <th class="text-right">Sms/Notif.</th>
                    <th class="text-center">Date</th>
                    <th class="text-left">Message</th>
                </tr>
                </thead>
                <tbody>
                <tr *ngFor="let sms of smsList; let i = index;" style="padding: 0px;">
                    <td>{{i+1}}</td>
                    <td style="padding-right: 15px;" align="right">{{sms.count}}/{{sms.notificationCount}}</td>
                    <td align="center">{{sms.sentDateTime | date: 'dd - MMM - yyyy'}}</td>
                    <td align="left" style="white-space: pre-line;">
                        {{sms.content}}
                    </td>
                </tr>
                </tbody>
            </table>

            <!-- SMS Table List -->
            <mat-accordion displayMode="flat" class="mat-table hidden-sm hidden-xs">

                <section class="mat-elevation-z2 mat-header-row">
                <span class="mat-header-cell">S No.</span>
                <span class="mat-header-cell">Count</span>
                <span class="mat-header-cell">Date</span>
                <span class="mat-header-cell">Message</span>
                </section>
        
                <mat-expansion-panel *ngFor="let sms of smsList; let i=index;"
                                    (opened)="sms.isOpen=true; serviceAdapter.getDeliveryReport(sms);"
                                    (closed)="sms.isOpen=false;">

                    <mat-expansion-panel-header class="mat-row">
                        <span class="mat-cell">{{i+1}}.</span>
                        <span class="mat-cell">{{sms.count}}</span>
                        <span class="mat-cell" >{{sms.sentDateTime | date: 'dd - MMM - yyyy'}}</span>
                        <span class="mat-cell">{{sms.content.substring(0,20)}}</span>
                    </mat-expansion-panel-header>

                    <ng-container *ngIf="sms.isOpen">

                        <ng-container *ngIf="sms.isLoading==true">
                            <div style="width: 100%" align="center">
                                <div class="loaderCustom"></div>
                            </div> 
                        </ng-container>
                                
                        <ng-container *ngIf="sms.isLoading==false">
                            
                            <div class="row">
                                <div class="col-sm-3">Message:</div>
                                <div class="col-sm-9" style="white-space: pre-line;">{{sms.content}}</div>
                            </div><br/>

                            <ng-container *ngFor="let status of getStatusList(sms); let last=last;">
                                {{status}}: {{getMobileNumberListByStatusAndSMS(status,sms).length}},&nbsp;&nbsp;
                            </ng-container>Total: {{getMobileNumberListBySMS(sms).length}}<br/><br/>

                            <mat-form-field>
                                <mat-select placeholder="Select Status"
                                            [(ngModel)]="selectedStatus">
                                    <mat-option *ngFor="let status of getStatusList(sms);" [value]="status">
                                        {{status}}
                                    </mat-option>
                                </mat-select>
                            </mat-form-field><br/><br/>

                            <ng-container *ngFor="let mobileNumber of getMobileNumberListByStatusAndSMS(selectedStatus, sms); let last=last;">
                                {{mobileNumber}}<ng-container *ngIf="!last">,&nbsp;&nbsp;</ng-container>
                            </ng-container>

                        </ng-container>

                    </ng-container>

                    <!-- div>
            
                        <ng-container *ngIf="student.studentFeeProfile">
                        <table class="table table-hover">
            
                            <thead class="text-{{user.activeSchool.secondaryThemeColor}}">
                            <tr>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th>Fees Due</th>
                            <th>Total Fees</th>
                            </tr>
                            </thead>
            
                            <tbody>
                            <tr>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td style="font-weight: 800; font-size: 16px;">{{getStudentFeesDue(student)}}</td>
                            <td style="font-weight: 800; font-size: 16px;">{{getStudentTotalFee(student)}}</td>
                            </tr>
                            <ng-container *ngFor="let sessionFeeStatus of student.studentFeeProfile.sessionFeeStatusList; let i=index;">
                            <ng-container *ngIf="getSessionFeesDue(sessionFeeStatus)>0">
                                <ng-container *ngIf="showSessionFeesLine(student)">
                                <tr>
                                    <td>{{i+1}}. {{sessionFeeStatus.sessionName}}</td>
                                    <td></td>
                                    <td></td>
                                    <td style="font-weight: 600;">{{getSessionFeesDue(sessionFeeStatus)}}</td>
                                    <td style="font-weight: 600;">{{getSessionTotalFee(sessionFeeStatus)}}</td>
                                </tr>
                                </ng-container>
                                <ng-container *ngFor="let component of sessionFeeStatus.componentList; let i=index;">
                                <ng-container *ngIf="getComponentTotalFee(component) != 0">
                                    <tr>
                                    <td></td>
                                    <td>{{component.feeType}}</td>
                                    <td></td>
                                    <td style="font-weight: 600;">{{getComponentFeesDue(component)}}</td>
                                    <td style="font-weight: 600;">{{getComponentTotalFee(component)}}</td>
                                    </tr>
                                    <ng-container *ngIf="component.frequency === frequencyList[1]">
                                    <ng-container *ngFor="let month of component.monthList">
                                        <ng-container *ngIf="getComponentMonthlyTotalFee(month)>0">
                                        <tr>
                                            <td></td>
                                            <td></td>
                                            <td>{{month.month}}</td>
                                            <td>{{getComponentMonthlyFeesDue(month)}}</td>
                                            <td>{{getComponentMonthlyTotalFee(month)}}</td>
                                        </tr>
                                        </ng-container>
                                    </ng-container>
                                    </ng-container>
                                </ng-container>
                                </ng-container>
                            </ng-container>
                            </ng-container>
                            </tbody>
                        </table>
            
                        </ng-container>

                    </div -->
                </mat-expansion-panel>
        
            </mat-accordion>
        
        </ng-container>

        <ng-container *ngIf="smsList.length==0">
            No SMS sent b/w {{startDate | date: 'dd - MMM - yyyy'}} to {{endDate | date: 'dd - MMM - yyyy'}}
        </ng-container>

    </ng-container>

</div>

<ng-container *ngIf="isLoading">
    <app-loading-spinner [user]="user"></app-loading-spinner>
</ng-container>
